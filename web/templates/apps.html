{{define "content"}}
{{if eq .Page "list"}}
<section>
    <div role="group">
        <a href="/ui/apps/new" role="button">New App</a>
        <button hx-get="/ui/apps/fragment" hx-target="#apps-list" class="secondary">Refresh</button>
    </div>
    <div id="apps-list" hx-get="/ui/apps/fragment" hx-trigger="load, every 10s">
        <article aria-busy="true">Loading apps...</article>
    </div>
</section>
{{else if eq .Page "new"}}
<section>
    <p><a href="/ui/apps">Back to apps</a></p>
    <article>
    <h2>Register New Application</h2>
    {{if .Error}}
    <p><mark>{{.Error}}</mark></p>
    {{end}}
    <form method="post" action="/ui/apps">
        <label for="name">App Name</label>
        <input type="text" id="name" name="name" value="{{.Form.Name}}" required placeholder="e.g., My Application">

        <label for="repo_url">Git Repository URL</label>
        <input type="text" id="repo_url" name="repo_url" value="{{.Form.RepoURL}}" required placeholder="git@github.com:user/repo.git or https://github.com/user/repo.git">

        <label for="repo_auth_method">Repository Access</label>
        <select id="repo_auth_method" name="repo_auth_method">
            <option value="public" {{if eq .Form.RepoAuth "public"}}selected{{end}}>Public repository</option>
            <option value="deploy_key" {{if eq .Form.RepoAuth "deploy_key"}}selected{{end}}>Private GitHub (deploy key)</option>
        </select>

        <label for="deploy_key">Deploy Private Key</label>
        <textarea id="deploy_key" name="deploy_key" rows="8" placeholder="-----BEGIN OPENSSH PRIVATE KEY-----">{{.Form.DeployKey}}</textarea>
        <small>Required only when using private GitHub deploy keys.</small>

        <label for="branch">Branch</label>
        <input type="text" id="branch" name="branch" value="{{.Form.Branch}}">

        <label for="compose_path">Compose File Path</label>
        <input type="text" id="compose_path" name="compose_path" value="{{.Form.ComposePath}}">

        <div role="group">
            <a href="/ui/apps" role="button" class="secondary">Cancel</a>
            <button type="submit">Register</button>
        </div>
    </form>
    </article>
</section>
{{else if eq .Page "detail"}}
<section>
    <p><a href="/ui/apps">Back to apps</a></p>
    <article>
        <header>
            <h2>{{.App.Name}}</h2>
            <p>Status: <strong>{{.App.Status}}</strong></p>
        </header>
        <table>
            <tbody>
                <tr><th scope="row">App ID</th><td><code>{{.App.ID}}</code></td></tr>
                <tr><th scope="row">Repository</th><td><a href="{{.App.RepoURL}}" target="_blank">{{.App.RepoURL}}</a></td></tr>
                <tr><th scope="row">Branch</th><td><code>{{.App.Branch}}</code></td></tr>
                <tr><th scope="row">Compose Path</th><td><code>{{.App.ComposePath}}</code></td></tr>
                <tr><th scope="row">Poll Interval</th><td><code>{{.App.PollInterval}}</code></td></tr>
                <tr><th scope="row">Last Seen Commit</th><td><code>{{.App.LastSeenCommit}}</code></td></tr>
                <tr><th scope="row">Last Sync</th><td>{{.App.LastSyncAt}}</td></tr>
            </tbody>
        </table>
        <div role="group">
            <button hx-post="/api/v1/apps/{{.App.ID}}/sync" hx-target="body" hx-swap="none" hx-on::after-request="if(event.detail.successful){window.location.reload();}">Force Sync</button>
            <button hx-delete="/api/v1/apps/{{.App.ID}}" hx-confirm="Delete this app?" hx-target="body" hx-swap="none" hx-on::after-request="if(event.detail.successful){window.location='/ui/apps';}" class="contrast">Delete App</button>
        </div>
    </article>
</section>
{{end}}
{{end}}
